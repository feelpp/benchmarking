{
    "executable": "feelpp_toolbox_heatfluid",
    "output_directory": "{{machine.output_app_dir}}/toolboxes/heatlfuid/eye",
    "use_case_name": "eye",
    "timeout":"0-01:00:00",
    "resources":{
        "tasks":"{{parameters.tasks.value}}",
        "exclusive_access":true
    },
    "input_file_dependencies":{
        "case_cfg":"feelpp_toolboxes/{{use_case_name}}/eye-{{parameters.position.value}}.cfg",
        "solver_cfg":"feelpp_toolboxes/{{use_case_name}}/pc_{{parameters.solver.value}}.cfg",
        "mesh_json":"feelpp_toolboxes/{{use_case_name}}/{{parameters.mesh.value}}/Eye_Mesh3D_p{{parameters.tasks.value}}.json",
        "mesh_hdf5":"feelpp_toolboxes/{{use_case_name}}/{{parameters.mesh.value}}/Eye_Mesh3D_p{{parameters.tasks.value}}.h5"
    },
    "platforms": {
        "apptainer":{
            "image": {
                "filepath":"{{machine.containers.apptainer.image_base_dir}}/feelpp.sif"
            },
            "input_dir":"/input_data/",
            "options": [
                "--home {{machine.output_app_dir}}",
                "--bind {{machine.input_dataset_base_dir}}/{{use_case_name}}/:{{platforms.apptainer.input_dir}}"
            ]
        },
        "builtin":{
            "input_dir":"{{machine.input_dataset_base_dir}}/feelpp_toolboxes/{{use_case_name}}/"
        }
    },
    "options": [
        "--config-files {{platforms.{{machine.platform}}.input_dir}}/{{input_file_dependencies.case_cfg}} {{platforms.{{machine.platform}}.input_dir}}/{{input_file_dependencies.solve_cfg}}",
        "--directory {{output_directory}}/{{instance}}",
        "--repository.case {{use_case_name}}",
        "--fail-on-unknown-option 1",
        "--heat-fluid.scalability-save=1",
        "--heat-fluid.heat.scalability-save=1",
        "--heat-fluid.fluid.scalability-save=1",
        "--repository.append.np 0",
        "--heat-fluid.json.patch='{\"op\": \"replace\",\"path\": \"/Meshes/heatfluid/Import/filename\",\"value\": \"{{input_file_dependencies.mesh_json}}\" }'"
    ],
    "additional_files":{
        "description_filepath":"{{output_directory}}/description.adoc",
        "parameterized_descriptions_filepath":"{{output_directory}}/{{instance}}/{{use_case_name}}/heatfluid.information.adoc",
        "custom_logs":[
            "{{output_directory}}/{{instance}}/{{use_case_name}}/logs/feelpp_toolbox_thermoelectric.INFO",
            "{{output_directory}}/{{instance}}/{{use_case_name}}/logs/feelpp_toolbox_thermoelectric.WARNING"
        ]
    },
    "scalability": {
        "directory": "{{output_directory}}/{{instance}}/{{use_case_name}}",
        "clean_directory":true,
        "stages": [
            {
                "name": "Constructor",
                "filepath": "heat-fluid.scalibility.HeatFluidConstructor.data",
                "format": "tsv"
            },
            {
                "name": "PostProcessing",
                "filepath": "heat-fluid.scalibility.HeatFluidPostProcessing.data",
                "format": "tsv"
            },
            {
                "name": "Solve",
                "filepath": "heat-fluid.scalibility.HeatFluidSolve.data",
                "format": "tsv",
                "units":{
                    "*":"s",
                    "ksp-niter":"iter"
                }
            }
        ],
        "custom_variables": [
            {
                "name":"Solve_assembly",
                "columns":[ "Solve_algebraic-newton-initial-guess", "Solve_algebraic-jacobian",  "Solve_algebraic-residual" ],
                "op":"sum",
                "unit":"s"
            }
        ]
    },
    "parameters": [
        {
            "name": "tasks",
            "sequence": [128,256,384]
        },
        {
            "name": "mesh",
            "sequence": ["M3","M4","M5"]
            // "sequence": ["M0","M1", "M2","M2", "M4","M5","M6"]
        },
        {
            "name": "position",
            "sequence": ["prone"]
            // "sequence": ["prone","standing","supine"]
        },
        {
            "name": "solver",
            "sequence": ["simple"]
            // "sequence": ["simple","lsc"]
        }
    ]
}