<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4. Hands-on (Session 2) :: Benchmarking</title>
    <link rel="canonical" href="https://feelpp.github.io/benchmarking/benchmarking/training/advanced/handsOn/index.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<script>!function(l,p){if(l.protocol!==p&&l.host=="docs.antora.org"){l.protocol=p}else if(/\.gitlab\.io$/.test(l.host)){l.replace(p+"//docs.antora.org"+l.pathname.substr(l.pathname.indexOf("/",1))+l.search+l.hash)}}(location,"https:")</script>

<script src="../../../../_/js/vendor/tabs-block-extension.js"></script>
<script src="../../../../_/js/vendor/tabs-block-behavior.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },

  TeX: {
      Macros: {
      bold: ["{\\bf #1}",1],
      calTh: "{\\mathcal{T}_h}",
      card: ["{\\operatorname{card}(#1)}",1],
      card: ["{\\operatorname{card}(#1)}",1],
      Ck: ["{\\mathcal{C}^{#1}}",1],
      deformt: ["{\\mathbf{\\varepsilon(#1)}}",1],
      diam: "{\\operatorname{diam}}",
      dim: ["{\\operatorname{dim}(#1)}",1],
      disp: ["{\\mathbf{#1}}",1],
      domain: "{\\Omega}",
      ds: "",
      essinf: "{\\operatorname{ess}\\, \\operatorname{inf}}",
      F:"{\\mathcal{F}}",
      geo: "{\\mathrm{geo}}",
      Ich: ["{\\mathcal{I}^{#1}_{c,h}#2}",2],
      Id: "{\\mathcal{I}}",
      Ilag: ["{\\mathcal{I}^{\\mathrm{lag}}_{#1}}",1],
      jump: ["{[\\![ #1 ]\\!]}",1],
      n:"{\\mathbf{n}}",
      Ne: "{N_{\\mathrm{e}}}",
      Next: "{\\mathrm{n}}",
      nf: "{n_f}",
      ngeo: "{n_{\\mathrm{geo}}}",
      Nma: "{N_{\\mathrm{ma}}}",
      NN: "{\\mathbb N}",
      Nno: "{N_{\\mathrm{no}}}",
      Nso: "{N_{\\mathrm{so}}}",
      opdim: "{\\operatorname{dim}}",
      p: "{\\mathrm{p}}",
      P:"{\\mathcal{P}}",
      Pch: ["{P^{#1}_{c,h}}",1],
      Pcho: ["{P^{#1}_{c,h,0}}",1],
      Pk: ["{\\mathcal{P}^{#1}}",1],
      poly: ["{\\mathbb{#1}",1],
      poly: ["{\\mathbb{#1}}",1],
      prect: ["{\\left\\(#1\\right\\)}",1],
      q:"{\\mathbf{q}}",
      Qch: ["{Q^{#1}_{c,h}}",1],
      Qk: ["{\\mathcal{Q}^{#1}}",1],
      R: ["{\\mathbb{R}^{#1}}",1],
      RR: "{\\mathbb R}",
      set: ["{\\left\\{#1\\right\\}}",1],
      stresst: ["{\\mathbf{\\sigma(#1)}}",1],
      T:"{\\mathcal{T}}",
      tr: "{\\operatorname{tr}}",
      v:"{\\mathbf{v}}",
      vertiii: ["\\left\\vert\\kern-0.25ex\\left\\vert\\kern-0.25ex\\left\\vert #1 \\right\\vert\\kern-0.25ex\\right\\vert\\kern-0.25ex\\right\\vert",1]
  },
  extensions: ["mhchem.js"] 
  }
});
</script>
<!--<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"></script>-->
<!-- <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script> -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_CHTML'></script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>-->

<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>-->
<script>var uiRootPath = '../../../../_'</script>

  </head>
  <body class="article">
<header class="header">
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark navbar-template-project" style="border-top: 4px solid #9E9E9E">
        <div class="navbar-brand">
            <div class="navbar-item feelpp-logo">
                <a href="https://feelpp.github.io/benchmarking">Benchmarking</a>
            </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <a href="https://docs.feelpp.org/">Documentation Reference</a>
                </div>
                <div class="navbar-item has-dropdown is-hoverable download-item">
                    <div class="navbar-item"><a href="https://docs.feelpp.org/user/latest/install/index.html" class="download-btn">Get Feel++</a></div>
                </div>
                <div class="navbar-item">
                    <a class="navbar-brand"  href="https://www.cemosis.fr">
                        <img class="cemosis-logo"  src="../../../../_/img/cemosis-logo.svg" alt="Cemosis logo"/>
                    </a>
                </div>
            </div>
        </div>
    </nav>
</header>
<div class="body">
<a href="#" class="menu-expand-toggle"></a>
<div class="nav-container" data-component="benchmarking" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">The Feel++ Benchmarking Project</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../index.html">Benchmarks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../tutorial/index.html">Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tutorial/gettingstarted.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../tutorial/configuration.html">Configuration Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorial/configurationfiles/system.html">System Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorial/configurationfiles/magicstrings.html">Magic Strings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorial/configurationfiles/machine.html">Machine Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorial/configurationfiles/benchmark.html">Benchmark Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorial/configurationfiles/plots.html">Plots Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Training</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../reframe/index.html">Introduction to <em>feelpp.benchmarking</em></a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/introduction.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/settings.html">System Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/machine_specs.html">Machine Specifications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/example_app.html">Example Application</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/benchmark_specs.html">Benchmark Specifications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/plot_specs.html">Plot Specifications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/executing.html">Executing the Benchmark</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../reframe/handsOn/index.html">Hands-on session 1</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/handsOn/exercise1.html">Exercise 1</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reframe/handsOn/exercise2.html">Exercise 2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Advanced Usage of <em>feelpp.benchmarking</em></a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../containers.html">Configuring Containers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../remote_files.html">Handling Remote Files</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../file_dependencies.html">Handling File Dependencies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../custom_perfvars.html">Custom Performance Variables</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory.html">Memory Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../visualization.html">Visualization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../workflow.html">Continuous Benchmarking Workflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="index.html">Hands-on session 2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Feel++ Benchmarking Project</span>
    <span class="version"></span>
  </div>
  <ul class="components">
      <li class="component is-current">
        <a class="title" href="../../../index.html">The Feel++ Benchmarking Project</a>
      </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
    <a href="../../../index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">The Feel++ Benchmarking Project</a></li>
    <li><a href="../../index.html">Training</a></li>
    <li><a href="index.html">Hands-on session 2</a></li>
  </ul>
</nav>

  
    <div class="edit-this-page"><a href="https://github.com/feelpp/benchmarking/edit/master/docs/modules/training/pages/advanced/handsOn/index.adoc">Edit this Page</a></div>
  
  <div class="page-downloads">
  <span class="label">Download as</span>
  <ul class="download-options">
    <li>
      <a onclick="print(this)" href="#" data-toggle="tooltip" data-placement="left" title="Print to PDF"
         class="pdf-download">
        <img class="pdf-file-icon icon" src="../../../../_/img/pdf.svg"/> .pdf
      </a>
    </li>
  </ul>
</div>
</div>

  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">4. Hands-on (Session 2)</h1>
<div class="sect1">
<h2 id="_benchmarking_a_feel_toolboxes_on_karolina"><a class="anchor" href="#_benchmarking_a_feel_toolboxes_on_karolina"></a>1. Benchmarking a Feel++ toolboxes on Karolina</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you start this hands-on exercise, you need to follow the steps below to set up your environment in Karolina.</p>
</div>
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>1.1. Pre-requisites</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>YOu must have set up <em>feelpp.benchmarking</em> beforehand. If not, please follow the prerequisites section of this <a href="https://bench.feelpp.org/benchmarking/training/reframe/handsOn/exercise2.html">exercise</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Load the required modules:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">module load Python/3.12.3-GCCcore-13.3.0
module load nodejs/20.13.1-GCCcore-13.3.0</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Source the existing Python virtual environment:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Make sure you are located in the directory where you have set up <em>feelpp.benchmarking</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">source .venv/bin/activate</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_feel_heat_transfer_toolbox"><a class="anchor" href="#_the_feel_heat_transfer_toolbox"></a>1.2. The Feel++ Heat Transfer toolbox</h3>
<div class="paragraph">
<p>In this exercice, we will benchmark the <strong>thermal bridges</strong> use case using of the Feel++ Heat transfer toolbox on Karolina.</p>
</div>
<div class="sect3">
<h4 id="_what_is_feel"><a class="anchor" href="#_what_is_feel"></a>1.2.1. What is Feel++ ?</h4>
<div class="quoteblock">
<blockquote>
Feel is an Open-Source C library which allows to solve a large range of partial differential equations using Galerkin methods, e.g. finite element method, spectral element method, discontinuous Galerkin methods or reduced basis methods.
</blockquote>
<div class="attribution">
&#8212; <a href="https://docs.feelpp.org/home/index.html">Feel++ Documentation</a>
</div>
</div>
<div class="paragraph">
<p>You can find more information on the Heat Transfer toolbox in this <a href="https://docs.feelpp.org/toolboxes/latest/heat/index.html">link</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_what_is_the_thermal_bridges_benchmark"><a class="anchor" href="#_what_is_the_thermal_bridges_benchmark"></a>1.2.2. What is The Thermal Bridges benchmark</h4>
<div class="paragraph">
<p>The benchmark known as "thermal bridges" is an example of an application that
enables us to validate numerical simulation tools using Feel++. We have developed tests based on the ISO 10211:2017 standard, which provides methodologies for evaluating thermal bridges in building construction.</p>
</div>
<div class="paragraph">
<p>Thermal bridges are areas within a building envelope where heat flow is different compared to adjacent areas, often resulting in increased heat loss or unwanted condensation. The standard is intended to ensure that thermal bridges simulation are accurately computed.</p>
</div>
<div class="paragraph">
<p>At the mathematical level, this application requires finding the numerical solution of an elliptic linear PDE (i.e. the heat equation). We employ a finite element method based on continuous Lagrange Finite Element of order 1,2 and 3 (denoted by P1,P2,P3). And we analyzed the execution time of the main components of the simulation.</p>
</div>
<div class="paragraph">
<p>Below, is an image showing the geometry and materials of the input mesh used in this benchmark.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/thermalBridgesMaterials.png" alt="Thermal Bridges Materials">
</div>
</div>
<div class="paragraph">
<p>The following image shows an example of the mesh partitioning, which is done beforehand.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/thermalBridgesPartitioning.png" alt="Thermal Bridges Partitioning">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modifying_karlinas_specification_file"><a class="anchor" href="#_modifying_karlinas_specification_file"></a>1.3. Modifying Karlina&#8217;s specification file</h3>
<div class="paragraph">
<p>As this benchmark is a little bit different than what we did in the previous exercices. The machine specifications file needs to be adapted.</p>
</div>
<div id="exer:1" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Using Apptainer</div>
<div class="paragraph">
<p>Start with copying this template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"machine": "karolina",
"targets":["&lt;TODO&gt;"],
"execution_policy": "async",
"reports_base_dir":"",
"input_dataset_base_dir":"",
"reframe_base_dir":"",
"output_app_dir":"",
"access":[
    "--account=dd-24-88",
    "--mem=200G",
    "--reservation=dd-24-88_2025-03-26T14:30:00_2025-03-26T17:00:00_40_qcpu"
],
"containers":&lt;TODO&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For now, complete only the <strong>targets</strong> and <strong>containers</strong> field considering the follwing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We will benchmark applications using Apptainer, on the qcpu partition and the default environment.</p>
</li>
<li>
<p>Container images should be placed under <code>/scratch/project/dd-24-88/benchmarking/inputdata/images/</code></p>
</li>
</ul>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"targets":["qcpu:apptainer:default"],
"containers":{
    "apptainer":{
        "image_base_dir":"/scratch/project/dd-24-88/benchmarking/inputdata/images",
        "options":[]
    }
}
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:2" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: I/O Base Directories</div>
<div class="paragraph">
<p>Modify the remaining fields with the directory paths considering the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All input files will be placed under <code>/scratch/project/dd-24-88/benchmarking/inputdata/</code></p>
</li>
<li>
<p>As multiple participants will execute tests having the same IDs, every output directory should be user dependent.</p>
</li>
<li>
<p>We should use the scratch file system for the benchmarked application I/O.</p>
</li>
<li>
<p>There is a <code>participants</code> folder under <code>/scratch/project/dd-24-88/benchmarking/</code>, but user-dependent directories are not yet created.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use the <code>$USER</code> environment variable.
</td>
</tr>
</table>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"reports_base_dir":"$PWD/reports",
"input_dataset_base_dir":"/scratch/project/dd-24-88/benchmarking/inputdata",
"reframe_base_dir":"/scratch/project/dd-24-88/benchmarking/participants/$USER/reframe",
"output_app_dir":"/scratch/project/dd-24-88/benchmarking/participants/$USER",
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In theory, the <code>output_app_dir</code> directory should exist before launching the applicaiton, but we can use a little trick to let <em>feelpp.benchmarking</em> create this directory : we set <code>"reframe_base_dir":"/scratch/project/dd-24-88/benchmarking/participants/$USER/reframe"</code> so that ReFrame creates the directory before running the tests.</p>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can see that under access, we have specified <code>--mem=200G</code>. This is actually just a bug workaround concerning SLURM configuration on Karolina.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_application_setup"><a class="anchor" href="#_application_setup"></a>1.4. Application setup</h3>
<div class="paragraph">
<p>We will benchmark this use case using a SIF image. The image is already located in Karolina, under <code>/scratch/project/dd-24-88/benchmarking/inputdata/images/feelpp-noble.sif</code>.</p>
</div>
<div class="paragraph">
<p>And the Feel++ toolbox can be executed inside the container using <code>feelpp_toolbox_heat</code>.</p>
</div>
<div class="paragraph">
<p>Start by creating a benchmark specification file, we will add fields to it on each exercice.</p>
</div>
<div id="exer:3" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Basic setup</div>
<div class="paragraph">
<p>Set the <strong>executable</strong>, <strong>use_case_name</strong>, and <strong>timeout</strong> fields, considering that each test case should not take more than 10 minutes.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"executable": "feelpp_toolbox_heat",
"use_case_name": "ThermalBridges",
"timeout":"0-00:10:00",
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:4" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: The platforms field</div>
<div class="paragraph">
<p>Create a <strong>platforms</strong> field specifying container related information needed by <em>feelpp.benchmarking</em>.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"platforms": {
    "apptainer":{
        "image": {
            "filepath":"{{machine.containers.apptainer.image_base_dir}}/feelpp-noble.sif"
        },
        "input_dir":"/input_data",
        "options": [
            "--home {{machine.output_app_dir}}",
            "--bind {{machine.input_dataset_base_dir}}/:{{platforms.apptainer.input_dir}}",
            "--env OMP_NUM_THREADS=1"
        ],
        "append_app_option":[]
    }
}
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:5" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: The builtin platforms</div>
<div class="paragraph">
<p>Suppose that this application is also installed on the system. How would you set up the benchmark specifications so that we can benchmark both the container and the built-in cases ?</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="paragraph">
<p>Add a builtin field to the platforms field. Now other fields can access input data directory based on the machine defined platform, using <code>{{platforms.{{machine.platform}}.input_dir}}</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"builtin":{
    "input_dir":"{{machine.input_dataset_base_dir}}",
    "append_app_option":[]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_input_data"><a class="anchor" href="#_input_data"></a>1.5. Input data</h3>
<div class="paragraph">
<p>The shared folder <code>/scratch/project/dd-24-88/benchmarking/inputdata/ThermalBridges/</code> contains all necessary input dependencies for the application.
It is structured as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ThermalBridges/</code></p>
<div class="ulist">
<ul>
<li>
<p><code>M1/</code> : mesh level 1</p>
</li>
<li>
<p><code>M2/</code>: mesh level 2</p>
</li>
<li>
<p><code>gamg.cfg</code> : configuration file for the Generalized Geometric-Algebraic MultiGrid solver</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each mesh folder contains a collection of partitionned meshes that use a Feel++ in-house format (JSON+HDF5).
The partitionned files are named <code>case3_p*.h5</code> and <code>case3_p*.json</code>, where * is the number of partitions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Running the test cases for the FEM order P3 and the mesh level 3 can take some time, so we will not use them in this session.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table shows the statistics on meshes and number of degrees of freedom with respect to the finite element approximation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/mesh_stats.png" alt="Mesh statistics">
</div>
</div>
<div class="sect3">
<h4 id="_resources"><a class="anchor" href="#_resources"></a>1.5.1. Resources</h4>
<div id="exer:6" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Resources</div>
<div class="paragraph">
<p>Create a <strong>parameter</strong> and add a <strong>resources</strong> field in order to execute tests using 32, 64 and 128 tasks.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"resources":{
    "tasks":"{{parameters.tasks.value}}",
},
"parameters": [
    {
        "name":"tasks",
        "sequence":[32,64,128]
    }
]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_parameters"><a class="anchor" href="#_parameters"></a>1.5.2. Parameters</h4>
<div id="exer:7" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Parameters</div>
<div class="paragraph">
<p>We want to evaluate how the mesh detail and the FEM order impact the solutions, and the performance of the application. Add the necessary parameters to evaluate this, considering available input data, and considering that the order takes the values P1 and P2.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"parameters": [
    {
        "name":"tasks",
        "sequence":[32,64,128]
    },
    {
        "name":"mesh",
        "sequence":["M1","M2"]
    },
    {
        "name":"discretization",
        "sequence":["P1","P2"]
    }
]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_memory"><a class="anchor" href="#_memory"></a>1.5.3. Memory</h4>
<div class="paragraph">
<p>After some debugging, we have noticed that tests for the different mesh - discretization parameter combinations require different amounts of memory.</p>
</div>
<div id="exer:8" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Memory</div>
<div class="paragraph">
<p>Modify <strong>parameters</strong> and <strong>resources</strong> to ensure the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The case M1 - P1 needs 100GB of RAM</p>
</li>
<li>
<p>The case M2 - P1 needs 200GB of RAM</p>
</li>
<li>
<p>The cases P2 - M1 and P2 - M2 need 300GB of RAM.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>qcpu</strong> nodes have 256GB of available memory.
</td>
</tr>
</table>
</div>
<details class="proof">
<summary class="title">Memory Solution 1</summary>
<div class="content">
<div class="paragraph">
<p>We can directly specify the parameter combinations inside a parameter, as a sequence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"resources":{
    "tasks":"{{parameters.tasks.value}}",
    "exclusive_access":true,
    "memory":"{{parameters.geometry.memory.value}}"
},
"parameters": [
    {
        "name":"tasks",
        "sequence":[32,64,128]
    },
    {
        "name":"geometry",
        "sequence":[
            {"mesh":"M1", "discretization":"P1", "memory":100},
            {"mesh":"M2", "discretization":"P1", "memory":200},
            {"mesh":"M1", "discretization":"P2", "memory":300},
            {"mesh":"M2", "discretization":"P2", "memory":300},
        ]
    }
]
}</code></pre>
</div>
</div>
</div>
</details>
<details class="proof">
<summary class="title">Memory Solution 2</summary>
<div class="content">
<div class="paragraph">
<p>We can use parameter conditions, this way we do not need to specify all possible combinations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"resources":{
    "tasks":"{{parameters.tasks.value}}",
    "exclusive_access":true,
    "memory":"{{parameters.memory.value}}"
},
"parameters": [
    {
        "name":"tasks",
        "sequence":[32,64,128]
    },
    {
        "name":"mesh",
        "sequence":["M1","M2"]
    },
    {
        "name":"discretization",
        "sequence":["P1","P2"]
    },
    {
        "name":"memory",
        "sequence":[100, 200, 300],
        "conditions":{
            "100": [ { "discretization": ["P1"], "mesh": ["M1"] } ],
            "200": [ { "discretization": ["P1"], "mesh": ["M2"] } ],
            "300": [ { "discretization": ["P2"] } ]
        }
    }
]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_setting_input_paths"><a class="anchor" href="#_setting_input_paths"></a>1.5.4. Setting input paths</h4>
<div class="paragraph">
<p>Now that the parameters are set, and we understand how the input data is structured, we can proceed to specifying the input files for each test case.</p>
</div>
<div id="exer:9" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Input dependencies</div>
<div class="paragraph">
<p>Add an <strong>input_file_dependencies</strong> field to specify the <strong>mesh_json</strong> and <strong>mesh_hdf5</strong> dependencies of all tests, using the parameter values and fields from the machine specification.</p>
</div>
<div class="paragraph">
<p>Remember that all files under <strong>input_file_dependencies</strong>, if relative, should be relative to <strong>input_dataset_base_dir</strong>.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"input_file_dependencies":{
    "solver_cfg":"ThermalBridges/gamg.cfg",
    "mesh_json":"ThermalBridges/{{parameters.mesh.value}}/case3_p{{parameters.tasks.value}}.json",
    "mesh_hdf5":"ThermalBridges/{{parameters.mesh.value}}/case3_p{{parameters.tasks.value}}.h5"
}
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:10" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Using custom fields</div>
<div class="paragraph">
<p>We have set the solver configuration file dependency. However, we might want to change this value in the future, but not parameterize it. So, you can create a custom field to set the solver name, and inject its value to the <strong>input_file_dependencies</strong> field.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"variables":{
    "solver":"gamg"
},
"input_file_dependencies":{
    "solver_cfg":"ThermalBridges/{{variables.solver}}.cfg",
}
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_outputs"><a class="anchor" href="#_outputs"></a>1.6. Outputs</h3>
<div class="paragraph">
<p>For this session, we require all application outputs to be written on a user-dependent directory.</p>
</div>
<div id="exer:11" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Setting an output_directory field</div>
<div class="paragraph">
<p>Using machine specifications, define an <strong>output_directory</strong> that will be used to refactor all filepaths concerning output files.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"output_directory": "{{machine.output_app_dir}}/ThermalBridges"
}</code></pre>
</div>
</div>
</div>
</details>
<div class="sect3">
<h4 id="_application_outputs"><a class="anchor" href="#_application_outputs"></a>1.6.1. Application outputs</h4>
<div class="paragraph">
<p>The toolbox exports the following files, depending on the specified output directory passed as an argument.</p>
</div>
<div class="paragraph">
<p>The files have a special format, that we will call "tsv". It is actually supported in <em>feelpp.benchmarking</em>. Use this format for scalability files.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">heat.scalibility.HeatConstructor.data</dt>
<dd>
<p>Contains the following columns: "initMaterialProperties","initMesh","initFunctionSpaces", "initPostProcess","graph","matrixVector","algebraicOthers"</p>
</dd>
<dt class="hdlist1">heat.scalibility.HeatPostProcessing.data</dt>
<dd>
<p>Contains only this column: "exportResults"</p>
</dd>
<dt class="hdlist1">heat.scalibility.HeatSolve.data</dt>
<dd>
<p>Contains the columns: "algebraic-assembly","algebraic-solve", "ksp-niter"</p>
</dd>
<dt class="hdlist1">heat.measures/values.csv</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Contains these columns for heat-flows "Normal_Heat_Flux_alpha", "Normal_Heat_Flux_beta", "Normal_Heat_Flux_gamma"</p>
</li>
<li>
<p>And these columns for temperature: "Points_alpha_max_field_temperature", "Points_alpha_min_field_temperature", "Points_beta_max_field_temperature", "Points_beta_min_field_temperature"</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="exer:12" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Specifying performance files</div>
<div class="paragraph">
<p>Supposing that previous performance and output files will be located under <code>{{output_directory}}/{{instance}}/{{use_case_name}}</code>, construct the <strong>scalability</strong> field by providing the filepaths, the "tsv" format and "csv" for outputs, and a prefix for variables on each stage.
Also, set the corresponding units for the following columns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ksp-niter : iter</p>
</li>
<li>
<p>Outputs: C</p>
</li>
<li>
<p>Execution times: s</p>
</li>
</ul>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"scalability": {
    "directory": "{{output_directory}}/{{instance}}/{{use_case_name}}",
    "clean_directory":true,
    "stages": [
        {
            "name": "Constructor",
            "filepath": "heat.scalibility.HeatConstructor.data",
            "format": "tsv"
        },
        {
            "name": "PostProcessing",
            "filepath": "heat.scalibility.HeatPostProcessing.data",
            "format": "tsv"
        },
        {
            "name": "Solve",
            "filepath": "heat.scalibility.HeatSolve.data",
            "format": "tsv",
            "units":{
                "*":"s",
                "ksp-niter":"iter"
            }
        },
        {
            "name":"Outputs",
            "filepath": "heat.measures/values.csv",
            "format": "csv",
            "units":{
                "*":"W"
            }
        }
    ]
}
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:13" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Custom variables</div>
<div class="paragraph">
<p>We want to analyse the total time taken by the whole application. However, this time is not exported in any file. This time can be composed as the sum of the columns "Constructor_init","Solve_solve", and "PostProcessing_exportResults".</p>
</div>
<div class="paragraph">
<p>Use the <strong>custom_variables</strong> to export this total time in the ReFrame report.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"scalability":{
    "custom_variables": [
        {
            "name":"Total",
            "columns":["Constructor_init","Solve_solve","PostProcessing_exportResults" ],
            "op":"sum",
            "unit":"s"
        }
    ]
}
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_additional_files"><a class="anchor" href="#_additional_files"></a>1.6.2. Additional files</h4>
<div class="paragraph">
<p>The Heat toolbox builds some Asciidoc files containing the description of the current test. We can include this in the report. These files can be found in <code>{{output_directory}}/{{instance}}/{{use_case_name}}/heat.information.adoc</code>.</p>
</div>
<div class="paragraph">
<p>Also, we can include some logfiles that are located under <code>{{output_directory}}/{{instance}}/{{use_case_name}}/logs/{{executable}}.INFO</code> and <code>{{output_directory}}/{{instance}}/{{use_case_name}}/logs/{{executable}}.WARNING</code>.</p>
</div>
<div id="exer:14" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Additional files</div>
<div class="paragraph">
<p>Build the <strong>additional_files</strong> field, using the <strong>parameterized_descriptions_filepath</strong> and <strong>custom_logs</strong> fields, to include all these files in the report</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "additional_files":{
        "parameterized_descriptions_filepath":"{{output_directory}}/{{instance}}/{{use_case_name}}/heat.information.adoc",
        "custom_logs":[
            "{{output_directory}}/{{instance}}/{{use_case_name}}/logs/{{executable}}.INFO",
            "{{output_directory}}/{{instance}}/{{use_case_name}}/logs/{{executable}}.WARNING"
        ]
    }
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_options"><a class="anchor" href="#_options"></a>1.7. Options</h3>
<div class="paragraph">
<p>Now that necessary fields are set, we should set the application options depending on the parameter values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"options": [
    "--config-files /usr/share/feelpp/data/testcases/toolboxes/heat/cases/Building/ThermalBridgesENISO10211/case3.cfg","{{platforms.{{machine.platform}}.input_dir}}/{{input_file_dependencies.solver_cfg}}",
    "--directory {{output_directory}}/{{instance}}",
    "--repository.case {{use_case_name}}",
    "--heat.scalability-save=1",
    "--repository.append.np 0",
    "--case.discretization {{parameters.discretization.value}}",
    "--heat.json.patch='{\"op\": \"replace\",\"path\": \"/Meshes/heat/Import/filename\",\"value\": \"{{platforms.{{machine.platform}}.input_dir}}/{{input_file_dependencies.mesh_json}}\" }'"
]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary"><a class="anchor" href="#_summary"></a>1.8. Summary</h3>
<details class="proof">
<summary class="title">Complete benchmark specification</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "executable": "feelpp_toolbox_heat",
    "use_case_name": "ThermalBridges",
    "timeout":"0-00:10:00",
    "output_directory": "{{machine.output_app_dir}}/ThermalBridges",
    "resources":{
        "tasks":"{{parameters.tasks.value}}",
        "exclusive_access":true,
        "memory":"{{parameters.memory.value}}"
    },

    "input_file_dependencies":{
        "solver_cfg":"ThermalBridges/{{fixed.solver}}.cfg",
        "mesh_json":"ThermalBridges/{{parameters.mesh.value}}/case3_p{{parameters.tasks.value}}.json",
        "mesh_hdf5":"ThermalBridges/{{parameters.mesh.value}}/case3_p{{parameters.tasks.value}}.h5"
    },

    "platforms": {
        "apptainer":{
            "image": {
                "filepath":"{{machine.containers.apptainer.image_base_dir}}/feelpp-noble.sif"
            },
            "input_dir":"/input_data",
            "options": [
                "--home {{machine.output_app_dir}}",
                "--bind {{machine.input_dataset_base_dir}}/:{{platforms.apptainer.input_dir}}",
                "--env OMP_NUM_THREADS=1"
            ],
            "append_app_option":[]
        },
        "builtin":{
            "input_dir":"{{machine.input_dataset_base_dir}}",
            "append_app_option":[]
        }
    },
    "options": [
        "--config-files /usr/share/feelpp/data/testcases/toolboxes/heat/cases/Building/ThermalBridgesENISO10211/case3.cfg","{{platforms.{{machine.platform}}.input_dir}}/{{input_file_dependencies.solver_cfg}}",
        "--directory {{output_directory}}/{{instance}}",
        "--repository.case {{use_case_name}}",
        "--heat.scalability-save=1",
        "--repository.append.np 0",
        "--case.discretization {{parameters.discretization.value}}",
        "--heat.json.patch='{\"op\": \"replace\",\"path\": \"/Meshes/heat/Import/filename\",\"value\": \"{{platforms.{{machine.platform}}.input_dir}}/{{input_file_dependencies.mesh_json}}\" }'"
    ],
    "additional_files":{
        "parameterized_descriptions_filepath":"{{output_directory}}/{{instance}}/{{use_case_name}}/heat.information.adoc",
        "custom_logs":[
            "{{output_directory}}/{{instance}}/{{use_case_name}}/logs/{{executable}}.INFO",
            "{{output_directory}}/{{instance}}/{{use_case_name}}/logs/{{executable}}.WARNING"
        ]
    },
    "scalability": {
        "directory": "{{output_directory}}/{{instance}}/{{use_case_name}}",
        "clean_directory":true,
        "stages": [
            {
                "name": "Constructor",
                "filepath": "heat.scalibility.HeatConstructor.data",
                "format": "tsv"
            },
            {
                "name": "PostProcessing",
                "filepath": "heat.scalibility.HeatPostProcessing.data",
                "format": "tsv"
            },
            {
                "name": "Solve",
                "filepath": "heat.scalibility.HeatSolve.data",
                "format": "tsv",
                "units":{
                    "*":"s",
                    "ksp-niter":"iter"
                }
            },
            {
                "name":"Outputs",
                "filepath": "heat.measures/values.csv",
                "format": "csv",
                "units":{
                    "*":"W"
                }
            }
        ],
        "custom_variables": [
            {
                "name":"Total",
                "columns":["Constructor_init","Solve_solve","PostProcessing_exportResults" ],
                "op":"sum",
                "unit":"s"
            }
        ]
    },
    "sanity": { "success": [], "error": [] },

    "fixed":{
        "solver":"gamg"
    },

    "parameters": [
        {
            "name":"tasks",
            "sequence":[32,64,128]
        },
        {
            "name":"mesh",
            "sequence":["M1","M2"]
        },
        {
            "name":"discretization",
            "sequence":["P1","P2"]
        },
        {
            "name":"memory",
            "sequence":[100, 200, 300],
            "conditions":{
                "100": [ { "discretization": ["P1"], "mesh": ["M1"] } ],
                "200": [ { "discretization": ["P1"], "mesh": ["M2"] } ],
                "300": [ { "discretization": ["P2"] } ]
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</details>
<div class="sect3">
<h4 id="_verification"><a class="anchor" href="#_verification"></a>1.8.1. Verification</h4>
<div class="paragraph">
<p>Before launching the benchmarks, we want to ensure that everything is set up correctly. For this, we can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>--list</code> flag to list all tests that will be executed.</p>
</li>
<li>
<p>The <code>--dry-run</code> flag to verify that input dependencies are found, and to take a quick look to the generated SLURM scripts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By running this command, we should see a total of 12 tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">feelpp-benchmarking-exec -mc examples/ThermalBridges/karolina.json  -bc examples/ThermalBridges/thermal_bridges.json --dry-run -rfm="-l -v"</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can run it without the <code>--list</code> flag to generate SLURM scripts.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plots"><a class="anchor" href="#_plots"></a>1.9. Plots</h3>
<div class="sect3">
<h4 id="_measure_validation"><a class="anchor" href="#_measure_validation"></a>1.9.1. Measure validation</h4>
<div class="paragraph">
<p>First, we are interested in seeing how computed measures (solutions) behave depending on the mesh refinement and the discretization used. What we expect to happen, is that the more refined the mesh is, and the bigger the FEM order parameter, the closer the solutions will be to the actual expected value.</p>
</div>
<div id="exer:15" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Heat Flux measures convergence analysis</div>
<div class="paragraph">
<p>Using the following template, create a figure description of a scatter plot, equipped with a slider, to be able to visualize the convergence of Heat Flows measures.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All performance variables are stored in a column accessible by the plot config, called <code>performance_variable</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"plots": [
    {
        "title": "",
        "plot_types": [ "" ],
        "transformation": "performance",
        "variables": [ ],
        "names": [ ],
        "xaxis": { "parameter": "", "label": "" },
        "yaxis": { "label": " " },
        "color_axis":{ "parameter": "", "label":"" },
        "secondary_axis":{ "parameter": "", "label": "" },
        "aggregations":[ {"column":"","agg":""} ]
    }
]
}</code></pre>
</div>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
"plots": [
    {
        "title": "Validation measures (Heat flux)",
        "plot_types": [ "scatter" ],
        "transformation": "performance",
        "variables": [
            "Outputs_Normal_Heat_Flux_alpha", "Outputs_Normal_Heat_Flux_beta", "Outputs_Normal_Heat_Flux_gamma"
        ],
        "names": [
            "Normal_Heat_Flux_alpha", "Normal_Heat_Flux_beta", "Normal_Heat_Flux_gamma"
        ],
        "xaxis": {
            "parameter": "mesh",
            "label": "mesh levels"
        },
        "yaxis": {
            "label": "Heat flow [W]"
        },
        "color_axis":{
            "parameter": "discretization",
            "label":"Discretization"
        },
        "secondary_axis":{
            "parameter": "performance_variable",
            "label": "Measures"
        },
        "aggregations":[ {"column":"tasks","agg":"max"} ]
    }
]
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:16" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Temperature measures convergence analysis</div>
<div class="paragraph">
<p>Repeat the previous exercice to reproduce the same figure, but for temperature measures.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "title": "Validation measures (Temperatures)",
    "plot_types": [ "scatter" ],
    "transformation": "performance",
    "variables": [
        "Outputs_Points_alpha_max_field_temperature", "Outputs_Points_alpha_min_field_temperature",
        "Outputs_Points_beta_max_field_temperature", "Outputs_Points_beta_min_field_temperature"
    ],
    "names": [
        "Points_alpha_max_field_temperature", "Points_alpha_min_field_temperature",
        "Points_beta_max_field_temperature", "Points_beta_min_field_temperature"
    ],
    "xaxis": {
        "parameter": "mesh",
        "label": "mesh levels"
    },
    "yaxis": {
        "label": "Temperature [C°]"
    },
    "color_axis":{
        "parameter": "discretization",
        "label":"Discretization"
    },
    "secondary_axis":{
        "parameter": "performance_variable",
        "label": "Measures"
    },
    "aggregations":[ {"column":"tasks","agg":"max"} ]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_analyzing_execution_times"><a class="anchor" href="#_analyzing_execution_times"></a>1.9.2. Analyzing execution times</h4>
<div class="paragraph">
<p>Now, we want to compare the time taken by the different steps of the application, and see how they scale depending on the number of tasks they run on.</p>
</div>
<div id="exer:17" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Visualizing stages performance</div>
<div class="paragraph">
<p>Compare the execution time of the <code>Cosntructor_init</code>, <code>Solve_algebraic-assembly</code>, <code>Solve_algebraic-solve</code> and <code>PostProcessing_exportResults</code>, depending on the mesh size and the number of tasks. We want only to analyze the first discretization order.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use <code>stacked_bar</code> and <code>grouped_bar</code> plot_types.
</td>
</tr>
</table>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "title": "Performance (P1)",
    "plot_types": [ "stacked_bar", "grouped_bar" ],
    "transformation": "performance",
    "variables": [
        "Constructor_init",
        "Solve_algebraic-assembly",
        "Solve_algebraic-solve",
        "PostProcessing_exportResults"
    ],
    "names": [
        "Preprocessing",
        "Algebraic assembly",
        "Algebraic solve",
        "Postprocess"
    ],
    "xaxis": {
        "parameter": "tasks",
        "label": "Number of tasks"
    },
    "secondary_axis": {
        "parameter": "mesh",
        "label": "Mesh level"
    },
    "yaxis": {
        "label": "execution time (s)"
    },
    "color_axis":{
        "parameter":"performance_variable",
        "label":"Performance variable"
    },
    "aggregations":[
        {"column":"performance_variable", "agg":"sum"},
        {"column":"discretization","agg":"filter:P1"}
    ]
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:18" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Strong scaling</div>
<div class="paragraph">
<p>Construct a plot to analyze the speedup of each application stage, for the second FEM order. Also include the total execution time.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "title": "Speedup (P2)",
    "plot_types": [ "scatter" ],
    "transformation": "speedup",
    "variables": [
        "Constructor_init",
        "Solve_algebraic-assembly",
        "Solve_algebraic-solve",
        "PostProcessing_exportResults",
        "Total"
    ],
    "names": [
        "Preprocessing",
        "Algebraic assembly",
        "Algebraic solve",
        "Postprocess",
        "Total"
    ],
    "xaxis": {
        "parameter": "tasks",
        "label": "Number of tasks"
    },
    "secondary_axis": {
        "parameter": "mesh",
        "label": "Mesh level"
    },
    "yaxis": {
        "label": "Speedup"
    },
    "color_axis":{
        "parameter":"performance_variable",
        "label":"Performance variable"
    },
    "aggregations":[
        {"column":"discretization","agg":"filter:P2"}
    ]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_other_performance_variables"><a class="anchor" href="#_other_performance_variables"></a>1.9.3. Other performance variables</h4>
<div id="exer:19" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Analyzing the number of iterations of the GMRES method</div>
<div class="paragraph">
<p>The <code>Solve_ksp-niter</code> performance variable contains the number of iterations taken by the GMRES method to converge. We want to compare this number of iterations between the chosen number of tasks, the mesh size and the discretization order.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "title":"Number of iterations of GMRES",
    "plot_types":["scatter"],
    "transformation":"performance",
    "variables":["Solve_ksp-niter"],
    "names":[],
    "xaxis":{
        "parameter":"tasks",
        "label":"Number of tasks"
    },
    "yaxis":{
        "label":"Number of iterations"
    },
    "color_axis":{
        "parameter":"mesh",
        "label":"Mesh"
    },
    "secondary_axis":{
        "parameter":"discretization",
        "label":"Discretization"
    },
    "aggregations":[
        {"column":"performance_variable","agg":"filter:Solve_ksp-niter"}
    ]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_multi_parameter_figures_optional"><a class="anchor" href="#_multi_parameter_figures_optional"></a>1.9.4. Multi-parameter figures (optional)</h4>
<div class="paragraph">
<p>We sometimes want to have all of the benchmarked information shown in the same figure. But this is quite difficult to do in a simple line plot if we have more than 2 parameters.
For this, <em>feelpp.benchmarking</em> support some multi-parametric figures, such as surface and 3D scatter plots, parallelcoordinates plots and sunburst charts. These, take an additional field on the plot configuration: the <strong>extra_axes</strong> field.</p>
</div>
<div id="exer:20" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Parallelcoorinates</div>
<div class="paragraph">
<p>Using the <code>parallelcoordinates</code> plot type, show which Mesh-discretization-memory values where actually executed.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "title": "Parameters",
    "plot_types": [ "parallelcoordinates" ],
    "transformation": "performance",
    "variables": ["Constructor_init", "Solve_solve", "PostProcessing_exportResults" ],
    "xaxis": { "parameter": "tasks", "label": "Tasks" },
    "secondary_axis": { "parameter": "mesh", "label": "Mesh" },
    "yaxis": { "label": "execution time (s)"},
    "color_axis": {"parameter":"performance_variable", "label":"Step"},
    "extra_axes": [ { "parameter": "discretization", "label": "Discretization" }]
}</code></pre>
</div>
</div>
</div>
</details>
<div id="exer:21" class="sidebarblock exer">
<div class="content">
<div class="title">Exercise: Sunburst chart</div>
<div class="paragraph">
<p>Using the <code>sunburst</code> plot type, show the time taken by different application stages for all parameter combinations.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "title": "Application Performance",
    "plot_types": [ "sunburst","scatter3d" ],
    "transformation": "performance",
    "variables": ["Constructor_init", "Solve_solve", "PostProcessing_exportResults" ],
    "xaxis": { "parameter": "tasks", "label": "Tasks" },
    "secondary_axis": { "parameter": "mesh", "label": "Mesh" },
    "yaxis": { "label": "execution time (s)"},
    "color_axis": {"parameter":"performance_variable", "label":"Step"},
    "extra_axes": [ { "parameter": "discretization", "label": "Discretization" }]
}</code></pre>
</div>
</div>
</div>
</details>
<details class="proof">
<summary class="title">Complete plot configuration</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "plots": [
        {
            "title": "Validation measures (Heat flux)",
            "plot_types": [ "scatter" ],
            "transformation": "performance",
            "variables": [ "Outputs_Normal_Heat_Flux_alpha", "Outputs_Normal_Heat_Flux_beta", "Outputs_Normal_Heat_Flux_gamma" ],
            "names": [ "Normal_Heat_Flux_alpha", "Normal_Heat_Flux_beta", "Normal_Heat_Flux_gamma" ],
            "xaxis": { "parameter": "mesh", "label": "mesh levels" },
            "yaxis": { "label": "Heat flow [W]" },
            "color_axis":{ "parameter": "discretization", "label":"Discretization" },
            "secondary_axis":{ "parameter": "performance_variable", "label": "Measures" },
            "aggregations":[ {"column":"tasks","agg":"max"} ]
        },
        {
            "title": "Validation measures (Temperatures)",
            "plot_types": [ "scatter" ],
            "transformation": "performance",
            "variables": [ "Outputs_Points_alpha_max_field_temperature", "Outputs_Points_alpha_min_field_temperature", "Outputs_Points_beta_max_field_temperature", "Outputs_Points_beta_min_field_temperature" ],
            "names": [ "Points_alpha_max_field_temperature", "Points_alpha_min_field_temperature", "Points_beta_max_field_temperature", "Points_beta_min_field_temperature" ],
            "xaxis": { "parameter": "mesh", "label": "mesh levels" },
            "yaxis": { "label": "Temperature [C°]" },
            "color_axis":{ "parameter": "discretization", "label":"Discretization" },
            "secondary_axis":{ "parameter": "performance_variable", "label": "Measures" },
            "aggregations":[ {"column":"tasks","agg":"max"} ]
        },
        {
            "title": "Performance (P1)",
            "plot_types": [ "stacked_bar", "grouped_bar" ],
            "transformation": "performance",
            "variables": [ "Constructor_init", "Solve_algebraic-assembly", "Solve_algebraic-solve", "PostProcessing_exportResults" ],
            "names": [ "Preprocessing", "Algebraic assembly", "Algebraic solve", "Postprocess" ],
            "xaxis": { "parameter": "tasks", "label": "Number of tasks" },
            "secondary_axis": { "parameter": "mesh", "label": "Mesh level" },
            "yaxis": { "label": "execution time (s)" },
            "color_axis":{ "parameter":"performance_variable", "label":"Performance variable" },
            "aggregations":[
                {"column":"performance_variable", "agg":"sum"},
                {"column":"discretization","agg":"filter:P1"}
            ]
        },
        {
            "title": "Speedup (P2)",
            "plot_types": [ "scatter" ],
            "transformation": "speedup",
            "variables": [ "Constructor_init", "Solve_algebraic-assembly", "Solve_algebraic-solve", "PostProcessing_exportResults", "Total" ],
            "names": [ "Preprocessing", "Algebraic assembly", "Algebraic solve", "Postprocess", "Total" ],
            "xaxis": { "parameter": "tasks", "label": "Number of tasks" },
            "secondary_axis": { "parameter": "mesh", "label": "Mesh level" },
            "yaxis": { "label": "Speedup" },
            "color_axis":{ "parameter":"performance_variable", "label":"Performance variable" },
            "aggregations":[
                {"column":"discretization","agg":"filter:P2"}
            ]
        },
        {
            "title":"Number of iterations of GMRES",
            "plot_types":["scatter"],
            "transformation":"performance",
            "variables":["Solve_ksp-niter"],
            "names":[],
            "xaxis":{ "parameter":"tasks", "label":"Number of tasks" },
            "yaxis":{ "label":"Number of iterations" },
            "color_axis":{ "parameter":"mesh", "label":"Mesh" },
            "secondary_axis":{ "parameter":"discretization", "label":"Discretization" },
            "aggregations":[
                {"column":"performance_variable","agg":"filter:Solve_ksp-niter"}
            ]
        },
        {
            "title": "Parameters",
            "plot_types": [ "parallelcoordinates" ],
            "transformation": "performance",
            "variables": ["Constructor_init", "Solve_solve", "PostProcessing_exportResults" ],
            "xaxis": { "parameter": "tasks", "label": "Tasks" },
            "secondary_axis": { "parameter": "mesh", "label": "Mesh" },
            "yaxis": { "label": "execution time (s)"},
            "color_axis": {"parameter":"performance_variable", "label":"Step"},
            "extra_axes": [ { "parameter": "discretization", "label": "Discretization" }]
        },
        {
            "title": "Application Performance",
            "plot_types": [ "sunburst","scatter3d" ],
            "transformation": "performance",
            "variables": ["Constructor_init", "Solve_solve", "PostProcessing_exportResults" ],
            "xaxis": { "parameter": "tasks", "label": "Tasks" },
            "secondary_axis": { "parameter": "mesh", "label": "Mesh" },
            "yaxis": { "label": "execution time (s)"},
            "color_axis": {"parameter":"performance_variable", "label":"Step"},
            "extra_axes": [ { "parameter": "discretization", "label": "Discretization" }]
        }
    ]
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer" style="border-top: 2px solid #e9e9e9; background-color: #fafafa; padding-bottom: 2em; padding-top: 2em;">
    <div class="container" style="display: flex; flex-direction: column; align-items: center; gap: 0.5em;">
        <div>
            <a href="https://www.cemosis.fr">
                <img src="../../../../_/img/cemosis-logo.svg" alt="Cemosis logo" height="50">
            </a>
        </div>
        <span style="font-size: 0.8rem; color: #9e9e9e">© 2025 <a href="https://www.cemosis.fr" style="text-decoration: underline;">Cemosis</a>, Université de Strasbourg</span>
    </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>


<script async src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>


<script type="text/javascript">
function toggleFullScreen() {
   var doc = window.document;
   var docEl = doc.documentElement;

   var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
   var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

   if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
       requestFullScreen.call(docEl);
   }
   else {
       cancelFullScreen.call(doc);
   }
}
</script>
  </body>
</html>
