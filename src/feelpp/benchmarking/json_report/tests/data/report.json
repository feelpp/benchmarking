{
    "data": [
        { "name": "students", "filepath": "students.csv", "format": "csv", "preprocessor": "./preprocessors.py:uppercase_names" },
        { "name": "attendance", "filepath": "attendance.json", "preprocessor": "./preprocessors.py:list_to_df"},
        { "name": "attendance_json_cols", "filepath": "attendance.json", "preprocessor":"./preprocessors.py:json_records_to_cols"},
        {
            "name": "notes",
            "filepath": "notes.txt",
            "format": "raw",
            "preprocessor": "./preprocessors.py:strip_newlines"
        }
    ],
    "contents": [
        {
            "type": "section",
            "title": "Report Overview",
            "contents": [
                {
                    "type": "text",
                    "text": "This report analyzes students' performance, attendance, and remarks across multiple subjects. We summarize scores, compute averages, and visualize trends."
                },
                {
                    "type": "text",
                    "ref":"attendance_json_cols",
                    "text": "Placeholders in this report allow dynamic insertion of values from the datasets. For example, total students: @{name |length}@."
                }
            ]
        },
        {
            "type": "section",
            "title": "Student Table",
            "contents": [
                {
                    "type": "table",
                    "ref": "students",
                    "table": {
                        "columns": ["name", "subject", "score", "passed"],
                        "computed_columns": {
                            "grade": "('A' if row['score'] >= 90 else 'B' if row['score'] >= 75 else 'C' if row['score'] >= 60 else 'F')"
                        },
                        "rename": {
                            "score": "Score",
                            "passed": "Passed",
                            "grade": "Grade"
                        },
                        "format": {
                            "Score": "%.1f",
                            "Passed": {"1": "✅", "0": "❌"}
                        },
                        "column_order": ["name", "subject", "Score", "Passed", "Grade"],
                        "style": {
                            "column_align": { "Score": "right", "Passed": "center", "Grade": "center" },
                            "column_width": { "Score": 5, "Passed": 3, "Grade": 3 },
                            "classnames": ["scrollable", "sortable"]
                        }
                    },
                    "filter": { "placeholder": "Filter students..." }
                }
            ]
        },
        {
            "type": "section",
            "title": "Attendance",
            "contents": [
                {
                    "type": "table",
                    "ref": "attendance",
                    "table": {
                        "columns": ["name", "subject", "days_present", "days_absent"],
                        "computed_columns": {
                            "attendance_rate": "row['days_present'] / (row['days_present'] + row['days_absent']) * 100"
                        },
                        "rename": {
                            "days_present": "Present Days",
                            "days_absent": "Absent Days",
                            "attendance_rate": "Attendance (%)"
                        },
                        "format": {
                            "Attendance (%)": "%.1f"
                        },
                        "column_order": ["name", "subject", "Present Days", "Absent Days", "Attendance (%)"],
                        "style": {
                            "column_align": { "attendance_rate": "right" },
                            "column_width": { "attendance_rate": 5 },
                            "classnames": ["sortable"]
                        }
                    },
                    "filter": { "placeholder": "Filter attendance..." }
                }
            ]
        },
        {
            "type": "section",
            "title": "Performance Analysis",
            "contents": [
                {
                    "type": "plot",
                    "ref": "students",
                    "plot": {
                        "title": "Average Scores by Subject",
                        "plot_types": ["scatter"],
                        "transformation": "performance",
                        "aggregations": [
                            { "column": "score", "agg": "mean" }
                        ],
                        "xaxis": { "parameter": "subject", "label": "Subject" },
                        "yaxis": { "parameter": "score", "label": "Average Score" },
                        "color_axis": { "parameter": "name", "label": "Student" }
                    }
                },
                {
                    "type": "plot",
                    "ref": "attendance",
                    "plot": {
                        "title": "Attendance Rate by Student",
                        "plot_types": ["grouped_bar"],
                        "transformation": "performance",
                        "xaxis": { "parameter": "name", "label": "Student" },
                        "yaxis": { "parameter": "days_present", "label": "Attendance (%)" },
                        "color_axis": { "parameter": "subject", "label": "Subject" }
                    }
                },
                {
                    "type": "text",
                    "text": "The scatter plot shows average scores per subject, while the bar chart shows average attendance rates for each student."
                }
            ]
        },
        {
            "type": "section",
            "title": "Teacher Notes",
            "contents": [
                {
                    "ref":"notes",
                    "type": "text",
                    "text": "Teacher remarks (loaded from a raw text file with preprocessing applied): @{notes}@"
                }
            ]
        }
    ]
}
