
{% set ns = namespace(keys=[]) %}
{% macro flatten_keys(d, prefix='') %}
  {% for k, v in d.items() %}
    {% set new_key = (prefix + '.' if prefix else '') + k %}
    {% if v is mapping %}
      {{ flatten_keys(v, new_key) }}
    {% else %}
      {% if new_key not in ns.keys %}
        {% set ns.keys = ns.keys + [new_key] %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endmacro %}

{% macro recursive_get_value(d, parts) -%}
  {% if parts | length == 0 %}{{ d }}{% else %}
    {% set first = parts[0] %}
    {% set rest = parts[1:] %}
    {% if d is mapping and first in d %} {{ recursive_get_value(d[first], rest) }} {% else %} '' {% endif %}
  {% endif %}
{%- endmacro %}

{% for testcase in run.testcases %} {{ flatten_keys(testcase.check_params) }} {% endfor %}

[.scrollable]
--
[cols="^1,^2,{% for _ in ns.keys %}<3,{% endfor %}<3{% if descriptions %},<3{% endif %}", options="header"]
|===
| |hashcode | {{ ns.keys | join(' | ') }} | {% if descriptions %}|  {% endif %}

{% for testcase in run.testcases %}
{%set _ = renderTemplate("logs.adoc.j2",{"script":testcase.script,"error_log":testcase.error_log,"output_log":testcase.output_log,"custom_logs":testcase.custom_logs}, self_dirpath+"/logs/"+testcase.hashcode+".adoc") %}
|{% if testcase.result == 'pass' %}ðŸŸ¢{% else %}ðŸ”´{% endif %}|{{testcase.hashcode}}{% for header in ns.keys %} | {{recursive_get_value(testcase.check_params, header.split('.'))}}{% endfor %} | xref:{{self_relpath}}/logs/{{testcase.hashcode}}.adoc[logs] {% if descriptions %} | xref:{{descriptions}}/{{testcase.hashcode}}.adoc[Description] {% endif %}
{% endfor %}



|===
--
++++
<input type="text" id="filterInput" placeholder="Filter testcases..." style="margin-bottom:0.5em;padding:0.3em;width:50%;">

<script>
document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById('filterInput');
  const table = document.querySelector('.scrollable table');
  if (!input || !table) return;

  input.addEventListener('input', function() {
    const term = input.value.toLowerCase();
    for (const row of table.querySelectorAll('tbody tr')) {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(term) ? '' : 'none';
    }
  });
});

document.addEventListener("DOMContentLoaded", function() {
  const table = document.querySelector('.scrollable table');
  if (!table) return;

  const headers = table.querySelectorAll('thead th');

  headers.forEach((header, index) => {
    header.style.cursor = 'pointer';
    header.addEventListener('click', () => {
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      const asc = header.dataset.sortOrder !== 'asc';

      // Reset all headers' arrows
      headers.forEach(h => h.textContent = h.textContent.replace(/[\u25B2\u25BC]\s*$/, '').trim());
      headers.forEach(h => delete h.dataset.sortOrder);

      // Set current header arrow
      header.dataset.sortOrder = asc ? 'asc' : 'desc';
      header.textContent = header.textContent.trim() + (asc ? ' â–²' : ' â–¼');

      // Sort rows
      rows.sort((a, b) => {
        const ta = a.children[index]?.textContent.trim();
        const tb = b.children[index]?.textContent.trim();
        const na = parseFloat(ta), nb = parseFloat(tb);
        if (!isNaN(na) && !isNaN(nb)) {
          return asc ? na - nb : nb - na;
        }
        return asc ? ta.localeCompare(tb) : tb.localeCompare(ta);
      });

      // Reinsert sorted rows
      rows.forEach(row => tbody.appendChild(row));
    });
  });
});

</script>
++++